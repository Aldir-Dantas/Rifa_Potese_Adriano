<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rifa Solid√°ria - Adriano</title>

<meta name="theme-color" content="#10b981">

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#10b981',
        secondary: '#facc15'
      }
    }
  }
}
</script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
body { font-family: 'Inter', sans-serif; }

.number-btn.sold {
  background:#ef4444;
  color:#fff;
  pointer-events:none;
  text-decoration:line-through;
}
.number-btn.reserved {
  background:#facc15;
  color:#78350f;
  pointer-events:none;
}
.number-btn.selected {
  background:#10b981;
  color:#fff;
  transform:scale(1.1);
}
</style>
</head>

<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-lg bg-white shadow-2xl rounded-xl p-6">

<header class="text-center mb-6">
  <h1 class="text-3xl font-extrabold text-primary">Rifa Solid√°ria - Adriano</h1>
  <p class="text-gray-700 font-semibold mt-2">Ajude-o a conquistar sua independ√™ncia</p>

  <div class="bg-yellow-50 border border-yellow-300 p-3 rounded-lg mt-4">
    <p class="text-sm font-medium text-gray-800">
      üèÜ <strong>Pr√™mio:</strong> Um lindo <strong>Bezerro</strong> |
      üéüÔ∏è <strong>Valor:</strong> R$ 20,00
    </p>
  </div>
</header>

<section class="mb-6">
<h2 class="font-bold mb-3">1. Escolha seu n√∫mero</h2>
<p id="selection-status" class="text-center text-primary font-semibold mb-3">Carregando...</p>
<div id="numbers-grid" class="grid grid-cols-5 gap-2 bg-gray-100 p-2 rounded-lg max-h-64 overflow-y-auto"></div>
</section>

<section class="mb-6">
<h2 class="font-bold mb-2">2. Pagamento PIX</h2>
<input id="pix-code" readonly class="w-full p-2 border rounded text-xs"
value="00020126820014br.gov.bcb.pix0136SUA_CHAVE_PIX_AQUI520400005303986540520.005802BR5920Aldir Dantas6009Sao Paulo6304XXXX">
<button id="copy-pix-btn" class="mt-2 w-full bg-primary text-white py-2 rounded">Copiar PIX</button>
<p id="copy-message" class="hidden text-green-600 text-sm mt-2 text-center">Pix copiado!</p>
</section>

<section>
<button id="whatsapp-btn" disabled
class="w-full bg-green-500 text-white font-bold py-3 rounded-lg disabled:opacity-50">
ENVIAR COMPROVANTE VIA WHATSAPP
</button>
</section>

</div>

<!-- MODAL -->
<div id="contact-modal" class="fixed inset-0 bg-black/70 hidden flex items-center justify-center">
<div class="bg-white p-6 rounded-lg w-full max-w-sm">
<h3 class="font-bold text-primary mb-4">Reservar N√∫mero</h3>

<form id="reservation-form">
<input id="user-name" required placeholder="Nome completo"
class="w-full border p-2 rounded mb-3">
<input id="user-phone" required placeholder="WhatsApp com DDD"
class="w-full border p-2 rounded mb-4">

<div class="flex gap-2">
<button type="button" id="cancel-reservation-btn"
class="flex-1 bg-gray-300 py-2 rounded">Cancelar</button>
<button class="flex-1 bg-primary text-white py-2 rounded">Reservar</button>
</div>
</form>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, onSnapshot, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

/* üî¥ TROQUE PELOS DADOS DO SEU FIREBASE */
const firebaseConfig = {
    apiKey: "AIzaSyA2f_ZkqJPPa4b4GK3sc0tyyRxJGUlgbfk",
    authDomain: "rifa-adriano.firebaseapp.com",
    projectId: "rifa-adriano",
    storageBucket: "rifa-adriano.firebasestorage.app",
    messagingSenderId: "504508820150",
    appId: "1:504508820150:web:fca6caa4f89ea133451417"
  };

const WHATSAPP_NUMBER = "5511999999999";
const TOTAL_NUMBERS = 100;
const COLLECTION = "rifa_adriano_status";
const DOC_ID = "current";
const RESERVED_PREFIX = "RESERVED|";

const numbersGrid = document.getElementById("numbers-grid");
const selectionStatus = document.getElementById("selection-status");
const whatsappBtn = document.getElementById("whatsapp-btn");
const modal = document.getElementById("contact-modal");

let db, auth, userId;
let reservedNumbers = {};
let selectedNumber = null;

const app = initializeApp(firebaseConfig);
auth = getAuth(app);
db = getFirestore(app);

signInAnonymously(auth);

onAuthStateChanged(auth, user => {
  if (!user) return;
  userId = user.uid;
  startListener();
});

function getDocRef() {
  return doc(db, COLLECTION, DOC_ID);
}

function startListener() {
  onSnapshot(getDocRef(), snap => {
    if (!snap.exists()) {
      const init = {};
      for (let i = 1; i <= TOTAL_NUMBERS; i++) {
        init[String(i).padStart(2,"0")] = "AVAILABLE";
      }
      setDoc(getDocRef(), init);
      return;
    }
    reservedNumbers = snap.data();
    renderGrid();
  });
}

function renderGrid() {
  numbersGrid.innerHTML = "";
  for (let i = 1; i <= TOTAL_NUMBERS; i++) {
    const n = String(i).padStart(2,"0");
    const status = reservedNumbers[n];
    let cls = "number-btn p-2 border rounded font-semibold ";

    if (status === "SOLD") cls += "sold";
    else if (status?.startsWith(RESERVED_PREFIX)) cls += "reserved";
    else cls += "bg-white hover:bg-secondary cursor-pointer";

    const btn = document.createElement("button");
    btn.textContent = n;
    btn.className = cls;
    btn.onclick = () => openModal(n);
    numbersGrid.appendChild(btn);
  }
}

function openModal(n) {
  selectedNumber = n;
  modal.classList.remove("hidden");
}

document.getElementById("cancel-reservation-btn").onclick = () => {
  modal.classList.add("hidden");
};

document.getElementById("reservation-form").onsubmit = async e => {
  e.preventDefault();
  const name = userName.value.trim();
  const phone = userPhone.value.replace(/\D/g,"");

  const status = `${RESERVED_PREFIX}${userId}|${encodeURIComponent(name)}|${phone}`;
  await updateDoc(getDocRef(), { [selectedNumber]: status });

  modal.classList.add("hidden");
  whatsappBtn.disabled = false;

  whatsappBtn.onclick = () => {
    const msg = `Ol√°, sou ${name} (${phone}). Fiz o Pix e reservei o n√∫mero ${selectedNumber}.`;
    window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`);
  };
};

document.getElementById("copy-pix-btn").onclick = () => {
  navigator.clipboard.writeText(document.getElementById("pix-code").value);
  document.getElementById("copy-message").classList.remove("hidden");
};
</script>
</body>
</html>
